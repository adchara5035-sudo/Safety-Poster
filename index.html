<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แจ้งเตือนความปลอดภัย - วางแผนการเดินทาง</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;700;900&display=swap');

        /* ตั้งค่าสำหรับการพิมพ์ */
        @page {
            size: A3 portrait;
            margin: 0;
        }

        * {
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
            color-adjust: exact !important;
        }

        body {
            font-family: 'Kanit', 'Tahoma', sans-serif;
            background-color: #111827;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            margin: 0;
        }

        .poster-container {
            width: 900px;
            min-height: 1200px;
            background: #ffffff !important;
            border: 2px solid #374151;
            position: relative;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
        }

        .header-section {
            background: linear-gradient(135deg, #000000 0%, #1f2937 100%) !important;
            background-color: #000 !important;
            color: #fbbf24 !important;
            padding: 50px 20px; 
            border-bottom: 10px solid #dc2626 !important;
            text-align: center;
        }

        .section-title {
            background-color: #1f2937 !important;
            color: white !important;
            padding: 12px 20px;
            font-size: 28px; 
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 10px 0 15px 0;
        }

        .section-title.danger-zone {
            background-color: #dc2626 !important;
        }

        .zone-card {
            border: 1px solid #e5e7eb !important;
            border-left: 10px solid #dc2626 !important;
            padding: 20px 25px; 
            background-color: #fef2f2 !important;
            height: 100%;
        }

        .route-highlight {
            background-color: #064e3b !important;
            color: #ecfdf5 !important;
            padding: 20px 30px; 
            border-radius: 6px;
            border: 3px solid #10b981 !important;
        }

        .curfew-stamp {
            border: 6px double #dc2626 !important;
            padding: 8px 12px; 
            text-align: center;
            color: #dc2626 !important;
            background-color: #fffafa !important;
            transform: rotate(-1deg);
            width: 100%;
            max-width: 340px;
            margin: 0 auto;
        }

        .footer-info {
            background-color: #111827 !important;
            color: #ffffff !important;
            padding: 25px 30px;
            font-size: 18px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-top: 4px solid #374151 !important;
            margin-top: auto;
        }

        .warning-strip {
            margin-top: 20px;
            background-color: #dc2626 !important;
            color: white !important;
            padding: 15px;
            text-align: center;
            font-weight: 900;
            font-size: 24px;
            border-radius: 8px;
            border: 2px solid #7f1d1d !important;
        }

        /* AI Panel Styles */
        .ai-panel {
            margin-top: 30px;
            padding: 25px;
            background: #f8fafc;
            border: 2px dashed #3b82f6;
            border-radius: 12px;
            width: 900px;
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.1);
        }

        .ai-button {
            background: linear-gradient(135deg, #1d4ed8 0%, #3b82f6 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .ai-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .ai-response {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            font-size: 16px;
            line-height: 1.6;
            display: none;
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; }
            .poster-container { 
                box-shadow: none !important; 
                border: none !important; 
                width: 100%; 
                height: 100%;
            }
        }
    </style>
</head>
<body>

<!-- ปุ่มสั่งพิมพ์ (จะซ่อนเมื่อสั่งพิมพ์จริง) -->
<div class="no-print mb-6">
    <button onclick="window.print()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-10 rounded-full shadow-2xl flex items-center gap-3 text-lg transition-transform active:scale-95">
        <i class="fas fa-print"></i> คลิกเพื่อสั่งพิมพ์ (Print / PDF)
    </button>
</div>

<div class="poster-container" id="printable-content">
    <!-- Header -->
    <div class="header-section">
        <h1 class="text-7xl font-[900] mb-4 tracking-tighter uppercase leading-none whitespace-nowrap">แจ้งเตือนความปลอดภัย</h1>
        <p class="text-2xl font-bold opacity-90 border-t-2 border-white/20 pt-3 inline-block">สถานการณ์ความขัดแย้งแนวชายแดนไทย–กัมพูชา</p>
        <div class="mt-8 flex justify-center items-center gap-4 text-lg">
            <span class="bg-red-600 px-6 py-2 rounded-full font-bold text-white border-2 border-white/30 text-base tracking-wide shadow-lg">อัปเดต : 18 ธันวาคม 2568</span>
        </div>
    </div>

    <div class="px-8 py-6 flex-grow">
        <!-- Area List -->
        <div class="section-title danger-zone shadow-lg">
            <i class="fas fa-exclamation-triangle text-3xl"></i> พื้นที่และเส้นทางที่ควรหลีกเลี่ยงอย่างเด็ดขาด
        </div>
        
        <div class="grid grid-cols-2 gap-6">
            <div class="zone-card shadow-sm">
                <h3 class="text-2xl font-black text-red-700 mb-3 border-b-2 border-red-100 pb-1">จ.สระแก้ว (พื้นที่เสี่ยงสูงสุด)</h3>
                <ul class="text-lg space-y-2 text-gray-900 font-bold">
                    <li>• เส้นทางช่องตะโก : <span class="text-red-600">ไม่ปลอดภัย / ตึงเครียดสูง</span></li>
                    <li>• อำเภอตาพระยา : บ้านคลองแผง ปะทะหนัก</li>
                    <li>• อรัญประเทศ/คลองหาด : จำกัดการเคลื่อนย้าย</li>
                </ul>
            </div>
            <div class="zone-card shadow-sm" style="border-left-color: #ef4444;">
                <h3 class="text-2xl font-black text-red-700 mb-3 border-b-2 border-red-100 pb-1">จ.ศรีสะเกษ</h3>
                <ul class="text-lg space-y-2 text-gray-900 font-bold">
                    <li>• ผามออีแดง / ช่องสะงำ : <span class="text-red-600 font-black">ห้ามเข้าเด็ดขาด</span></li>
                    <li>• อ.กันทรลักษ์/ภูสิงห์ : ระวังอาวุธหนัก</li>
                </ul>
            </div>
            <div class="p-5 border-2 border-gray-200 bg-gray-50 rounded-lg">
                <h3 class="text-xl font-black text-gray-900 border-b-2 border-gray-300 mb-2">จ.สุรินทร์ & บุรีรัมย์</h3>
                <p class="text-[17px] text-gray-800 font-bold leading-relaxed">
                    ปราสาทตาเมือนธม / ตาควาย / ด่านช่องจอม (ปิด) <br>
                    ช่องสายตะกู / อ.บ้านกรวด / อ.ละหานทราย
                </p>
            </div>
            <div class="p-5 border-2 border-gray-200 bg-gray-50 rounded-lg">
                <h3 class="text-xl font-black text-gray-900 border-b-2 border-gray-300 mb-2">จ.อุบลฯ / จันทบุรี / ตราด</h3>
                <p class="text-[17px] text-gray-800 font-bold leading-relaxed">
                    ช่องบก (<span class="text-red-700">ปะทะรุนแรง</span>) / ด่านบ้านหาดเล็ก <br>
                    ด่านบ้านแหลม / ด่านบ้านผักกาด (ปิดทำการ)
                </p>
            </div>
        </div>

        <!-- Safe Routes Section -->
        <div class="section-title" style="background: #064e3b; margin-top: 30px;">
            <i class="fas fa-route"></i> เส้นทางที่แนะนำ (สำหรับภาคอีสานใต้)
        </div>
        <div class="route-highlight">
            <div class="flex justify-around items-center text-center">
                <div class="flex flex-col items-center">
                    <div class="text-sm font-bold opacity-90 uppercase tracking-widest mb-1">ทางหลวงหมายเลข</div>
                    <div class="text-8xl font-black text-white leading-none">304</div>
                    <div class="text-2xl font-black mt-3 text-green-100">กบินทร์บุรี – ปักธงชัย</div>
                </div>
                <div class="h-32 border-l-2 border-green-500/30 mx-8"></div>
                <div class="flex flex-col items-center">
                    <div class="text-sm font-bold opacity-90 uppercase tracking-widest mb-1">ทางหลวงหมายเลข</div>
                    <div class="text-8xl font-black text-white leading-none">24</div>
                    <div class="text-2xl font-black mt-3 text-green-100">โชคชัย – เดชอุดม</div>
                </div>
            </div>
        </div>

        <!-- Measures Section -->
        <div class="grid grid-cols-12 gap-4 mt-5 items-stretch">
            <div class="col-span-5 flex items-center justify-center">
                <div class="curfew-stamp bg-red-50">
                    <div class="font-black text-xl uppercase tracking-widest text-red-600 mb-1">มาตรการเคอร์ฟิว</div>
                    <div class="text-4xl font-black my-0.5 leading-none">19 : 00 - 05 : 00</div>
                    <div class="text-[15px] font-black border-t-2 border-red-200 pt-2 mt-2 leading-tight text-gray-900">
                        บังคับใช้พื้นที่ จ.สระแก้ว <br>
                        (อรัญประเทศ, ตาพระยา, คลองหาด, โคกสูง)
                    </div>
                </div>
            </div>
            
            <div class="col-span-7 bg-amber-50 border-l-8 border-amber-500 p-4 flex flex-col justify-center shadow-sm">
                <h4 class="text-2xl font-black text-amber-900 mb-1 border-b-2 border-amber-200 pb-1">
                    <i class="fas fa-shield-alt mr-2 text-xl"></i> มาตรการบังคับใช้ด่วน
                </h4>
                <div class="space-y-2">
                    <div class="text-[16px] text-amber-950 font-bold leading-snug">
                        <span class="text-red-700">• การปิดด่าน :</span> ปิดด่านถาวร 7 จังหวัด 
                    </div>
                    <div class="text-[16px] text-amber-950 font-bold leading-tight pl-4 text-sm text-gray-700">
                        (สระแก้ว, ศรีสะเกษ, สุรินทร์, บุรีรัมย์, อุบลฯ, จันทบุรี, ตราด)
                    </div>
                    <div class="text-[16px] text-amber-950 font-bold">
                        <span class="text-red-700">• การข่าว :</span> ติดตามประกาศจาก กองทัพภาคที่ 1 และ 2
                    </div>
                </div>
            </div>
        </div>

        <div class="warning-strip shadow-xl">
            <i class="fas fa-hand-paper mr-3"></i> ห้ามเข้าใกล้แนวชายแดนเด็ดขาด หากไม่มีเหตุจำเป็น
        </div>
    </div>

    <!-- Footer -->
    <div class="footer-info">
        <div class="text-center">
            <p class="text-2xl font-black tracking-wide">
                <i class="fas fa-heart text-red-500 mr-3"></i> 
                ด้วยความห่วงใยจาก Safety Center
                <i class="fas fa-heart text-red-500 ml-3"></i>
            </p>
        </div>
    </div>
</div>

<!-- AI Helper Panel (Only Travel Planning) -->
<div class="ai-panel no-print mb-10">
    <div class="flex items-center gap-4 mb-6">
        <div class="bg-blue-600 text-white p-3 rounded-xl shadow-lg shadow-blue-200">
            <i class="fas fa-map-marked-alt text-2xl"></i>
        </div>
        <div>
            <h3 class="text-xl font-black text-gray-900">วางแผนการเดินทางปลอดภัย (AI Analysis)</h3>
            <p class="text-sm text-blue-700 font-bold">ตรวจสอบความเสี่ยงของเส้นทางตามฐานข้อมูลประกาศล่าสุด</p>
        </div>
    </div>

    <div id="route-planner" class="bg-white p-6 border-2 border-blue-100 rounded-xl shadow-inner">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div>
                <label class="block text-sm font-black text-gray-600 mb-2 uppercase tracking-wider">ต้นทาง</label>
                <div class="relative">
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                        <i class="fas fa-location-dot"></i>
                    </span>
                    <input type="text" id="start-node" placeholder="ระบุจังหวัดต้นทาง" class="w-full pl-10 pr-4 py-3 border-2 border-gray-100 rounded-lg font-bold text-gray-800 outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-50 transition-all">
                </div>
            </div>
            <div>
                <label class="block text-sm font-black text-gray-600 mb-2 uppercase tracking-wider">ปลายทาง</label>
                <div class="relative">
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                        <i class="fas fa-flag-checkered"></i>
                    </span>
                    <input type="text" id="end-node" placeholder="ระบุจุดหมายปลายทาง" class="w-full pl-10 pr-4 py-3 border-2 border-gray-100 rounded-lg font-bold text-gray-800 outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-50 transition-all">
                </div>
            </div>
        </div>
        <button onclick="aiAnalyzeRoute()" class="w-full bg-blue-700 hover:bg-blue-800 text-white font-black py-4 rounded-xl shadow-xl shadow-blue-100 transition-all flex items-center justify-center gap-3 active:scale-[0.98]">
            <i class="fas fa-shield-alt text-xl"></i> วิเคราะห์ความปลอดภัยของเส้นทางนี้
        </button>
    </div>

    <div id="ai-loading" class="mt-6 hidden flex items-center justify-center gap-3 py-6">
        <div class="loader"></div>
        <span class="text-blue-600 font-black">Gemini AI กำลังวิเคราะห์ข้อมูลพื้นที่ปะทะและด่านปิด...</span>
    </div>

    <div id="ai-output" class="ai-response shadow-md border-t-4 border-t-blue-600">
        <!-- AI Response Content Goes Here -->
    </div>
</div>

<script>
    const apiKey = ""; // Runtime provides the key

    async function callGemini(prompt, systemInstruction = "") {
        const loading = document.getElementById('ai-loading');
        const output = document.getElementById('ai-output');
        
        loading.classList.remove('hidden');
        output.style.display = 'none';

        const retry = async (n) => {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: systemInstruction }] }
                    })
                });
                
                if (!response.ok) throw new Error('API Error');
                
                const result = await response.json();
                return result.candidates?.[0]?.content?.parts?.[0]?.text;
            } catch (err) {
                if (n === 1) throw err;
                await new Promise(r => setTimeout(r, Math.pow(2, 5 - n) * 1000));
                return retry(n - 1);
            }
        };

        try {
            const text = await retry(5);
            loading.classList.add('hidden');
            output.innerHTML = `<div class="prose prose-sm max-w-none text-gray-800 font-medium">
                <div class="flex items-center gap-2 mb-4 text-blue-700 font-black uppercase tracking-wider text-sm border-b pb-2">
                    <i class="fas fa-shield-check"></i> ผลการวิเคราะห์เส้นทางโดย AI
                </div>
                ${text.replace(/\n/g, '<br>')}
                <div class="mt-4 p-3 bg-blue-50 border border-blue-100 rounded text-xs text-blue-800 font-bold">
                    <i class="fas fa-info-circle mr-1"></i> ข้อมูลนี้เป็นการวิเคราะห์เบื้องต้นตามประกาศ โปรดตรวจสอบสถานการณ์จริง ณ ด่านตรวจอีกครั้ง
                </div>
            </div>`;
            output.style.display = 'block';
        } catch (error) {
            loading.classList.add('hidden');
            output.innerHTML = `<div class="text-red-600 font-bold p-4 bg-red-50 border border-red-100 rounded">
                <i class="fas fa-exclamation-circle mr-2"></i> ไม่สามารถติดต่อระบบ AI ได้ในขณะนี้ โปรดตรวจสอบการเชื่อมต่ออินเทอร์เน็ตของคุณ
            </div>`;
            output.style.display = 'block';
        }
    }

    function getPosterData() {
        return document.getElementById('printable-content').innerText;
    }

    function aiAnalyzeRoute() {
        const start = document.getElementById('start-node').value;
        const end = document.getElementById('end-node').value;
        if (!start || !end) return;

        const data = getPosterData();
        const prompt = `ผู้ใช้ต้องการเดินทางจาก "${start}" ไปยัง "${end}" ในช่วงสถานการณ์ความขัดแย้งชายแดน โดยอ้างอิงจากข้อมูลพื้นที่เสี่ยง มาตรการเคอร์ฟิว และด่านที่ปิดในประกาศนี้: \n ${data} \n\n ช่วยวิเคราะห์และให้คำแนะนำ:
        1. เส้นทางนี้ผ่านพื้นที่อันตรายหรือพื้นที่ที่มีการปะทะหนักหรือไม่?
        2. มีมาตรการเคอร์ฟิวหรือด่านปิดที่เป็นอุปสรรคต่อเส้นทางนี้หรือไม่?
        3. คำแนะนำในการเลี่ยงเส้นทางหรือการเตรียมตัว (สรุปสั้นๆ เข้าใจง่าย)`;
        
        const system = "คุณคือระบบวางแผนเส้นทางปลอดภัยอัจฉริยะ ทำหน้าที่วิเคราะห์ความเสี่ยงการเดินทางโดยอ้างอิงข้อมูลจากประกาศทางราชการที่ระบุไว้เท่านั้น ตอบข้อมูลที่แม่นยำและสร้างความปลอดภัย";
        callGemini(prompt, system);
    }
</script>

</body>
</html>
